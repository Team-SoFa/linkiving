name: "Storybook Deployment"
run-name: ${{ github.actor}}ì˜ ìŠ¤í† ë¦¬ë¶ ë°°í¬
on: # PR ë¨¸ì§€ ì „ì—ëŠ” pull_requestë§Œ ì‹¤í–‰, ë¨¸ì§€ í›„ mainì—ëŠ” pushë§Œ ì‹¤í–‰
  pull_request:
    branches: [main]
    paths:
      - '**/*.stories.tsx'
    types: [opened, synchronize, reopened]  # ì´ ìƒíƒœì¼ë•Œë§Œ PR ë°°í¬ ì‹¤í–‰

  push:
    branches: [main]
    paths:
      - '**/*.stories.tsx'

jobs:
  storybook-deploy: #job idëª…ìœ¼ë¡œ, ë¡œê·¸ í™”ë©´ì—ì„œ ëœ¨ëŠ” ì´ë¦„. ê± ì›í•˜ëŠ” ê±° ì“°ë©´ ë¨(ê°€ë…ì„±, ê´€ë¦¬ í¸ì˜ì„± ìš©ë„
    # Operating System
    runs-on: ubuntu-latest
    outputs:
        status: ${{ job.status }}   # jobì´ ì‹¤í–‰ëœ ê²°ê³¼ê°’ì„ ì •ì˜í•´ì„œ, ë‹¤ë¥¸ jobì—ì„œ ì°¸ì¡°í•  ìˆ˜ ìˆë„ë¡ í•¨(ë¹Œë“œ ì„±ê³µ/ì‹¤íŒ¨ ìƒíƒœ ì „ë‹¬, ë¹Œë“œ ê²°ê³¼ë¬¼ ê²½ë¡œ/URL ê³µìœ , í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ìˆ˜ì¹˜ ì „ë‹¬
    # Job steps
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3 # Update to the latest version of checkout action
        with:
            fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v3 # Example of using a different action
        with:
            node-version: 18

      - name: Cache Dependencies
        id: cache
        uses: actions/cache@v3
        with:
            path: ~/.npm
            key: ${{ runner.os }}-npm-${{ hashFiles('**/package-lock.json') }}
            restore-keys: |
              ${{ runner.os }}-npm
      - run: npm install

      - name: Publish Chromatic
        id: chromatic
        uses: chromaui/action@v1 # Update to the latest version of Chromatic action
        with:
            projectToken: ${{ secrets.CHROMATIC_PROJECT_TOKEN }}
            buildScriptName: build-storybook
      - name: PR Comment
        uses: thollander/actions-comment-pull-request@v1
        if: ${{ github.event_name == 'pull_request' }}
        with:
            message: 'ğŸš€ **storybook url**: ${{ steps.chromatic.outputs.storybookUrl }}'